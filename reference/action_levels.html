<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Set action levels: failure thresholds and functions to invoke — action_levels • pointblank</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Set action levels: failure thresholds and functions to invoke — action_levels" />
<meta property="og:description" content="The action_levels() function works with the actions argument that is
present in the create_agent() function and in every validation step
function. With it, we can provide threshold fail levels for any combination
of warn, stop, or notify states. We can react to any entrance of a
state by supplying corresponding functions to the fns argument. They will
undergo evaluation at the time when the matching state is entered. If
provided to create_agent() then the policies will be applied to every
validation step, acting as a default for the validation as a whole. Calls of
action_levels() could also be applied directly to any validation step and
this will act as an override if set also in create_agent(). Usage of
action_levels() is required to have any useful side effects (i.e.,
warnings, throwing errors) in the case of validation functions operating
directly on data. There are two helper functions that are convenient when
using validation functions with data: warn_on_fail() and
stop_on_fail(). These helpers either warn or stop (default failure
threshold for each is set to 1), and, they do so with informative warning
or error messages." />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pointblank</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/intro-to-pointblank.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rich-iannone/pointblank">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Set action levels: failure thresholds and functions to invoke</h1>
    <small class="dont-index">Source: <a href='https://github.com/rich-iannone/pointblank/blob/master/R/action_levels.R'><code>R/action_levels.R</code></a></small>
    <div class="hidden name"><code>action_levels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>action_levels()</code> function works with the <code>actions</code> argument that is
present in the <code>create_agent()</code> function and in every validation step
function. With it, we can provide threshold <em>fail</em> levels for any combination
of <code>warn</code>, <code>stop</code>, or <code>notify</code> states. We can react to any entrance of a
state by supplying corresponding functions to the <code>fns</code> argument. They will
undergo evaluation at the time when the matching state is entered. If
provided to <code>create_agent()</code> then the policies will be applied to every
validation step, acting as a default for the validation as a whole. Calls of
<code>action_levels()</code> could also be applied directly to any validation step and
this will act as an override if set also in <code>create_agent()</code>. Usage of
<code>action_levels()</code> is required to have any useful side effects (i.e.,
warnings, throwing errors) in the case of validation functions operating
directly on data. There are two helper functions that are convenient when
using validation functions with data: <code>warn_on_fail()</code> and
<code>stop_on_fail()</code>. These helpers either warn or stop (default failure
threshold for each is set to <code>1</code>), and, they do so with informative warning
or error messages.</p>
    </div>

    <pre class="usage"><span class='fu'>action_levels</span>(warn_at = <span class='kw'>NULL</span>, stop_at = <span class='kw'>NULL</span>, notify_at = <span class='kw'>NULL</span>, fns = <span class='kw'>NULL</span>)

<span class='fu'>warn_on_fail</span>(warn_at = <span class='fl'>1</span>)

<span class='fu'>stop_on_fail</span>(stop_at = <span class='fl'>1</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>warn_at, stop_at, notify_at</th>
      <td><p>The threshold number or fraction of
validation units that can provide a <em>fail</em> result before entering the
<code>warn</code>, <code>stop</code>, or <code>notify</code> failure states. If this a decimal value between
<code>0</code> and <code>1</code> then it's a proportional failure threshold (e.g., <code>0.15</code>
indicates that if 15% percent of the validation units are found to <em>fail</em>,
then the designated failure state is entered). Absolute values starting
from <code>1</code> can be used instead, and this constitutes an absolute failure
threshold (e.g., <code>10</code> means that if 10 of the validation units are found to
<em>fail</em>, the failure state is entered).</p></td>
    </tr>
    <tr>
      <th>fns</th>
      <td><p>A named list of functions that is to be paired with the
appropriate failure states. The syntax for this list involves using failure
state names from the set of <code>warn</code>, <code>stop</code>, and <code>notify</code>. The functions
corresponding to the failure states are provided as formulas (e.g.,
<code><a href='https://rdrr.io/r/base/list.html'>list(warn = ~ warning("Too many failures."))</a></code>. A series of expressions for
each named state can be used by enclosing the set of statements with <code>{ }</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The output of the <code>action_levels()</code> call in <code>actions</code> will be interpreted
slightly differently if using an <em>agent</em> or using validation functions
directly on a data table. For convenience when working directly on data, any
values supplied to <code>warn_at</code> or <code>stop_at</code> will be automatically given a stock
<code><a href='https://rdrr.io/r/base/warning.html'>warning()</a></code> or <code><a href='https://rdrr.io/r/base/stop.html'>stop()</a></code> function. If you were to supply those manually then
the stock functions would be overridden. Furthermore, if <code>actions</code> is NULL in
this workflow, <strong>pointblank</strong> will use a <code>stop_at</code> value of <code>1</code> (providing an
error message if there are any <em>fail</em> units). We can absolutely suppress this
automatic stopping behavior by at each validation step by setting <code>active = FALSE</code>. In this interactive data case there is no stock function given for
the <code>notify_at</code>. The <code>notify</code> failure state is less commonly used in this
workflow as it is in the <em>agent</em>-based one.</p>
<p>When using an <em>agent</em>, we often opt to not use any functions in <code>fns</code> as the
<code>warn</code>, <code>stop</code>, and <code>notify</code> failure states will be reported on when using
<code>create_agent_report()</code> (and, usually that's sufficient).</p>
    <h2 class="hasAnchor" id="function-id"><a class="anchor" href="#function-id"></a>Function ID</h2>

    

<p>1-4</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Planning and Prep: 
<code>col_schema()</code>,
<code>create_agent()</code>,
<code>scan_data()</code>,
<code>validate_rmd()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Create a simple data frame with</span>
<span class='co'># a column of numerical values</span>
<span class='kw'>tbl</span> <span class='op'>&lt;-</span> <span class='kw'>dplyr</span>::<span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(a = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>5</span>, <span class='fl'>7</span>, <span class='fl'>8</span>, <span class='fl'>5</span>))

<span class='co'># Create an `action_levels()` list</span>
<span class='co'># with fractional values for the</span>
<span class='co'># `warn`, `stop`, and `notify` states</span>
<span class='kw'>al</span> <span class='op'>&lt;-</span> 
  <span class='fu'>action_levels</span>(
    warn_at = <span class='fl'>0.2</span>,
    stop_at = <span class='fl'>0.8</span>,
    notify_at = <span class='fl'>0.345</span>
  )

<span class='co'># Validate that values in column</span>
<span class='co'># `a` are always greater than 7 and</span>
<span class='co'># apply the list of action levels</span>
<span class='kw'>agent</span> <span class='op'>&lt;-</span>
  <span class='fu'>create_agent</span>(tbl = <span class='kw'>tbl</span>) <span class='op'>%&gt;%</span>
  <span class='fu'>col_vals_gt</span>(<span class='fu'>vars</span>(<span class='kw'>a</span>), <span class='fl'>7</span>, actions = <span class='kw'>al</span>) <span class='op'>%&gt;%</span>
  <span class='fu'>interrogate</span>()

<span class='co'># The report from the agent will show</span>
<span class='co'># that the `warn` state has been entered</span>
<span class='co'># for the first and only validation step.</span>

<span class='co'># agent</span>
  
<span class='co'># In the context of using validation</span>
<span class='co'># stop functions directly on data, their</span>
<span class='co'># use is commonly to trigger warnings</span>
<span class='co'># and raise errors. The following will</span>
<span class='co'># provide a error (but that's suppressed</span>
<span class='co'># here).</span>
<span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span>(
  <span class='kw'>tbl</span> <span class='op'>%&gt;%</span>
    <span class='fu'>col_vals_gt</span>(<span class='fu'>vars</span>(<span class='kw'>a</span>), <span class='fl'>5</span>, actions = <span class='kw'>al</span>)
)</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 4 x 1</span><span>
#&gt;       a
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     5
#&gt; </span><span style='color: #555555;'>2</span><span>     7
#&gt; </span><span style='color: #555555;'>3</span><span>     8
#&gt; </span><span style='color: #555555;'>4</span><span>     5</div><div class='input'></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Richard Iannone.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


